<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<style>
    html,body{background: #273341;}
    #mycanvas{}  
    .pie{width: 320px;height: 320px;margin: 0 auto;}
    img{width: 100%;display: none}
    .economy{text-align: center;transform: rotate(45deg);color: #fff;font-family: "微软雅黑";font-size: 14px;}
</style>
<body>
   <div class="pie">       
    <canvas id="canvas" width="960" height="960" style="width:640px;height:640px;"></canvas>
   </div>
<!-- canvas的画布宽高（分辨率）是width和height，而style中的宽高是canvas在页面中显示的宽高，画布分辨率越高，绘制出来的图任意缩放也不会出现很大的锯齿 -->
</body>
<script src="js/jquery-1.10.2.js"></script>
<script>
    // 圆心坐标
    var circleCenter = {x:480,y:480};
</script>
<script src="common.js"></script>
<script>
// 模拟数据
var mok_data = [
    {
        "信访来源": "市信访局",
        "返回日期": "2013-04-28",
        "信访人": "陈用深",
        "信访类型": "城镇拆迁",
        "受理日期": "2013-03-27",
        "信访区域": "禅城区",
        "信访标题": "禅城区title1",
        "登记时间": "2013-03-27",
        "登记人": "陈翠婷",
        "承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
        "ID": "SDJSJID9467566",
        "relationIndex": []
    },
    {
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "顺德区",
		"信访标题": "顺德区title1",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    },
    {
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "禅城区",
		"信访标题": "禅城区title2",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    },
    {
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "三水区",
		"信访标题": "三水区title1",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
	},{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "高明区",
		"信访标题": "高明区title1",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "三水区",
		"信访标题": "三水区title2",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "禅城区",
		"信访标题": "禅城区title3",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "禅城区",
		"信访标题": "禅城区title4",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "高明区",
		"信访标题": "高明区title2",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "南海区",
		"信访标题": "南海区title2",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "南海区",
		"信访标题": "南海区title4",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
    }
    ,{
		"信访来源": "市信访局",
		"返回日期": "2013-04-28",
		"信访人": "陈用深",
		"信访类型": "城镇拆迁",
		"受理日期": "2013-03-27",
		"信访区域": "顺德区",
		"信访标题": "顺德区title4",
		"登记时间": "2013-03-27",
		"登记人": "陈翠婷",
		"承办单位名称": "禅城区国土城建和水务局 房地产市场监管科 房产管理科 ",
		"ID": "SDJSJID9467566",
		"relationIndex": []
	}
];
// 数据整理
// 合并重复地区和个数
var areaCountArr = [];
mok_data.forEach(function(e,i){
    areaCountArr.push(e.信访区域);
})
var transAreaCount = getAreaDe(areaCountArr);

console.log('mok_data',mok_data.sort(compare("信访区域")));
var newSortData = mok_data.sort(compare("信访区域"));

// -------------------------------------------------------
var canvas = document.getElementById('canvas');  
var r_area = 280,r_width=80;
var r_title = 280; 
var r_man = 480;
var bgColor =  '#273341';
var ctx = canvas.getContext('2d');
if (canvas.getContext){
    // 先根据数据比例绘制扇形占比
    transAreaCount.forEach(function(e){
          ites(e.start,e.end,r_area,'#88acf0');
          drawCircularText(r_area,e.area,rads(e.start+10),rads(e.end-10),'center');
    })
    //内覆盖扇形背景圆2
    ites(0,360,r_area - r_width,bgColor);

    // 绘制上方文字
    var verticalDeArr = setPoint(newSortData);
    console.log('newSortData',newSortData);
    newSortData.forEach(function(e,i){
        drawVerticalText(e.信访标题,verticalDeArr[i],r_title);
    })
}
</script>
</html>